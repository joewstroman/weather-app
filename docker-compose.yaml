version: '2' 
services:
  db:
    build:
      context: ./database
    #For ease of use in the demo port will be exposed on localhost
    ports:
      - 3306:3306
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DB_NAME: ${MYSQL_DB_NAME}
      MYSQL_TABLE_NAME: ${MYSQL_TABLE_NAME}
  restapi:
    links: 
      - db
    build:
      context: ./restapi
    command: ./wait-for-db.sh db
    restart: always
    environment:
      DB_HOST: db
      DB_USER: ${MYSQL_USER}
      DB_PASSWORD: ${MYSQL_PASSWORD}
      DB_NAME: ${MYSQL_DB_NAME}
  auth:
    ports:
      - 9000:3000
    build:
      context: ./auth
  web:
    build:
      args:
        REACT_APP_MYSQL_TABLE_NAME: ${MYSQL_TABLE_NAME}
      context: ./web
    ports:
      - 80:5000
  